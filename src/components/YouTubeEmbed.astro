---
interface Props {
    videoUrl: string;
    title: string;
    duration?: string;
}

const { videoUrl, title, duration } = Astro.props;

// Extract video ID from YouTube URL
function getYouTubeId(url: string): string | null {
    const regExp =
        /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
    const match = url.match(regExp);
    return match && match[2].length === 11 ? match[2] : null;
}

const videoId = getYouTubeId(videoUrl);
---

{
    videoId && (
        <div class="not-prose my-12">
            <div class="relative group">
                {/* Video indicator badge */}
                <div class="absolute -top-3 left-4 z-10 flex items-center gap-2 px-3 py-1.5 bg-red-600 text-white text-xs font-mono rounded-full border border-red-500 shadow-lg">
                    <svg
                        class="w-3 h-3"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    <span>VIDEO</span>
                    {duration && <span class="opacity-75">â€¢ {duration}</span>}
                </div>

                {/* Video container with aspect ratio */}
                <div class="relative w-full overflow-hidden rounded-lg border-2 border-zinc-800 bg-zinc-950 shadow-2xl transition-all duration-300 group-hover:border-zinc-700 group-hover:shadow-red-500/20">
                    {/* 16:9 aspect ratio container */}
                    <div class="relative pb-[56.25%]">
                        <iframe
                            class="absolute top-0 left-0 w-full h-full"
                            src={`https://www.youtube-nocookie.com/embed/${videoId}?rel=0`}
                            title={title}
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                        />
                    </div>
                </div>

                {/* Glow effect on hover */}
                <div class="absolute inset-0 -z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <div class="absolute inset-0 bg-gradient-to-r from-red-500/20 to-zinc-500/20 blur-xl transform scale-105" />
                </div>
            </div>

            {/* Video info */}
            <div class="mt-4 p-4 rounded border border-zinc-800 bg-zinc-900/50">
                <div class="flex items-start gap-3">
                    <svg
                        class="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
                    </svg>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm text-zinc-400 font-mono leading-relaxed">
                            Watch the complete implementation walkthrough on
                            YouTube. This video covers all the concepts
                            discussed in this article with live coding and
                            detailed explanations.
                        </p>
                        <a
                            href={videoUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 mt-3 text-xs font-mono text-red-400 hover:text-red-300 transition-colors group/link"
                        >
                            <span>Watch on YouTube</span>
                            <svg
                                class="w-3 h-3 transition-transform group-hover/link:translate-x-0.5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M14 5l7 7m0 0l-7 7m7-7H3"
                                />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    )
}

<style>
    /* Ensure the video embed is responsive */
    iframe {
        border-radius: 0.375rem;
    }

    /* Smooth animation for the glow effect */
    @keyframes pulse-glow {
        0%,
        100% {
            opacity: 0.5;
        }
        50% {
            opacity: 1;
        }
    }
</style>
